<!-- Full HTML remains unchanged up to existing <script> section -->

<!-- Add to your HTML before <script> -->
<div class="input-area">
  <button class="action-button" onclick="startTest()">🧠 Placement Test</button>
  <button class="action-button" onclick="showLeadForm()">📋 Enroll Now</button>
  <button class="action-button" onclick="readText()">🔊 Hear Thai Greeting</button>
  <button class="action-button" onclick="showCourseList()">📚 Browse Courses</button>
  <button class="action-button" onclick="showLecturers()">👩‍🏫 Meet Lecturers</button>
  <button class="action-button" onclick="showSampleVideo()">🎥 Watch Sample Class</button>
</div>

<div id="video-container" style="display:none; text-align:center; margin-top:1rem;">
  <p>👩‍🏫 Here's a sample from our Thai language class:</p>
  <iframe width="100%" height="315" src="https://youtube.com/shorts/sLUGhhrO4SM?si=jn5sDfCXWjFoukQg" 
    title="AI Thai Class Sample" frameborder="0" allowfullscreen></iframe>
</div>

<script>
  const chatLog = document.getElementById('chat-log');
  const welcomeMsg = document.getElementById('welcome-msg');

  const messages = {
    en: "🤖 Hello! I am your AI Concierge for OKay Thai. How can I assist you today?",
    mm: "🤖 မင်္ဂလာပါ။ OKay Thai မှ AI Concierge ဖြစ်ပါတယ်။ ဘာဝန်ဆောင်မှုလိုပါသလဲ။",
    th: "🤖 สวัสดีค่ะ! ฉันคือ AI ผู้ช่วยของคุณจาก OKay Thai มีอะไรให้ช่วยไหมคะ?"
  };

  function setLanguage(lang) {
    localStorage.setItem('lang', lang);
    welcomeMsg.innerText = messages[lang];
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }

  window.onload = () => {
    const lang = localStorage.getItem('lang') || 'en';
    const theme = localStorage.getItem('theme') || 'default';
    setLanguage(lang);
    setTheme(theme);
  };

  function appendMessage(message, sender = 'ai') {
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `${sender === 'ai' ? '🤖' : '👤'} ${marked.parseInline(message)}`;
    chatLog.appendChild(div);
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  function showLeadForm() {
    document.getElementById('lead-form').style.display = 'flex';
  }

  function readText() {
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance('สวัสดีค่ะ');
    utter.lang = 'th-TH';
    synth.speak(utter);
  }

  function showCourseList() {
    appendMessage("We offer: 1. Thai Speaking Only, 2. 4-skills Thai Class, 3. One-on-One, 4. Children’s Group Class, 5. Private Group Class.");
  }

  function showLecturers() {
    appendMessage("👩‍🏫 TR. ZAW — 5 years teaching experience.\n👩‍🏫 TR. PHYU — Translator at Toyota, 2 years teaching.\n👩‍🏫 TR. MAY — Fluent in Thai, 3 years in Thai Company.");
  }

  function showSampleVideo() {
    document.getElementById('video-container').style.display = 'block';
    appendMessage("🎥 Playing AI-generated class sample. Watch and enjoy!");
  }

  // Full Placement Test Logic
  const testQuestions = [
    {
      q: "What does \"สวัสดี\" mean?",
      options: ["Goodbye", "Thank you", "Hello", "Please"],
      correct: 2
    },
    {
      q: "What is the Thai word for \"water\"?",
      options: ["ข้าว", "น้ำ", "ไฟ", "ปลา"],
      correct: 1
    },
    {
      q: "Choose the Thai script for \"school\".",
      options: ["ห้องเรียน", "นักเรียน", "โรงเรียน", "หนังสือ"],
      correct: 2
    },
    {
      q: "Which tone is used in \"ขาว\" (white)?",
      options: ["Mid", "Rising", "Falling", "Low"],
      correct: 1
    },
    {
      q: "Which Thai sentence means \"I like to learn Thai\"?",
      options: [
        "ฉันชอบเรียนภาษาไทย",
        "ผมไม่เรียนภาษาไทย",
        "ฉันไปโรงเรียน",
        "ผมชอบอาหารไทย"
      ],
      correct: 0
    }
  ];

  let currentQuestion = 0;
  let score = 0;

  function startTest() {
    currentQuestion = 0;
    score = 0;
    askQuestion();
  }

  function askQuestion() {
    const q = testQuestions[currentQuestion];
    let msg = `🧠 Q${currentQuestion + 1}: ${q.q}`;
    q.options.forEach((opt, i) => {
      msg += `\n${String.fromCharCode(65 + i)}. ${opt}`;
    });
    appendMessage(msg);
    waitForAnswer();
  }

  function waitForAnswer() {
    document.addEventListener('keydown', handleKey);
  }

  function handleKey(e) {
    const key = e.key.toUpperCase();
    const validKeys = ['A', 'B', 'C', 'D'];
    if (!validKeys.includes(key)) return;
    document.removeEventListener('keydown', handleKey);

    const selected = validKeys.indexOf(key);
    const correct = testQuestions[currentQuestion].correct;

    if (selected === correct) {
      appendMessage("✅ Correct!", 'ai');
      score++;
    } else {
      appendMessage(`❌ Incorrect. Correct answer is ${String.fromCharCode(65 + correct)}.`, 'ai');
    }

    currentQuestion++;
    if (currentQuestion < testQuestions.length) {
      setTimeout(askQuestion, 1000);
    } else {
      setTimeout(showResult, 1000);
    }
  }

  function showResult() {
    const level = score >= 4 ? 'Advanced' : score >= 2 ? 'Intermediate' : 'Beginner';
    appendMessage(`🎉 You scored ${score}/${testQuestions.length}. Recommended level: **${level}**.`);
    appendMessage(`📥 Would you like to enroll in a class? Click \"Enroll Now\" to get started.`);
  }

  document.getElementById('lead-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const contact = document.getElementById('contact').value;
    const interest = document.getElementById('interest').value;

    const payload = { name, contact, interest };

    fetch('https://script.google.com/macros/s/AKfycbxkX1OmhdUuwcrGgFRmX07FOl7CqeTF_HTJv__A1WmOeVVWde1Q7_zwd7FzPuTck1PQFQ/exec', {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: { 'Content-Type': 'application/json' }
    })
    .then(res => res.json())
    .then(data => {
      appendMessage(`Thanks, ${name}! We saved your interest in ${interest}. Our team will contact you soon.`);
      document.getElementById('lead-form').reset();
      document.getElementById('lead-form').style.display = 'none';
    })
    .catch(err => {
      console.error('Error saving lead:', err);
      alert('There was a problem saving your lead. Try again.');
    });
  });
</script>
</body>
</html>
